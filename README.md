# Vacation Rentals Application

Vacation Rentals is web application to expose RestFul JSON API for handling Vacation Rentals properties.

The technology stack used to implement it is made of:

* Scala 2.12
* Scalatra 2.5.1
* Java 1.8.0_74
* Akka
* Maven 3.3.9
* Swagger for documenting API
* Jetty Server

## Getting started

1. Clone this repository:

		git clone https://carminec26@bitbucket.org/carminec26/vacationrentals.git

2. Change directory into your clone:

		cd vacationrentals

3. Maven build

		mvn install

4. Start Jetty

		mvn jetty:run

5. Go to 

        http://localhost:8080/listings

## Internal Design

The application is designed based on several layers.

1. Servlet: contains the Scalatra servlets where the endpoints are defined 
2. Service: contains the services and interacts with the Dao layer to communicate with the underlying database
3. Dao: contains the methods to communicate with the database 

The database is implemented using a data structure in memory.

Other components are:

* Model: it is a representation of the listing in the domain, used ultimately to pass the information to the database
* Dto: classes used for representing the listing information in input to the Api
* For the asynchronous api the package actor contains the Akka actor and messages.

The testing is implemented at Service level. 

## API Description

There are 5 endpoints exposed.

The swagger documentation is at the following urls

* http://localhost:8080/apidoc 
* http://localhost:8080/apidoc/listings for details about each api

### Search All Listings

Endpoint: http://localhost:8080/listings

Returns all the listings in the database.

### Search A Listing by Id
Endpoint: http://localhost:8080/listings/5e22a83a-6f4f-11e6-8b77-86f30ca893d3

Returns 200 and the listing identified by the id or 404 Not Found otherwise.

### Add a New Listing
Endpoint: http://localhost:8080/listings/add

with json body. The id will be generated by the application.

``` 
{
    "contact": {
        "phone": "111111111",
        "formattedPhone": "222222222"
    },
    "address": {
        "address": "Oxford Street",
        "postalCode": "W1N6G",
        "countryCode": "UK",
        "city": "London",
        "state": "London",
        "country": "United Kingdom"
    },
    "location": {
        "lat": 40.65464565,
        "lng": -5.65656565
    }
} 
```

Returns 200 with the listing added as content and in the header the Url location where to the new listing 
If an error happens it will return a 204 No Content with reasons the exception message.

### Modify a Listing
Endpoint: http://localhost:8080/listings/5b492bfe-3154-4f29-8601-b6558a9d75e2

with json body
 
``` 
{
    "contact": {
        "phone": "111111111",
        "formattedPhone": "222222222"
    },
    "address": {
        "address": "Oxford Street",
        "postalCode": "W1N6G",
        "countryCode": "UK",
        "city": "London",
        "state": "London",
        "country": "United Kingdom"
    },
    "location": {
        "lat": 40.65464565,
        "lng": -5.65656565
    }
} 
```

Returns 200 if the listing is modified. 
If an error happens it will return a 404 Not Found with the exception message.

### Delete a Listing
Endpoint: http://localhost:8080/listings/34fd59fc-5598-48c0-985e-9b828504cc5f

Returns 200 if the listing is deleted. 
If an error happens it will return a 404 Not Found with the exception message.

## Asynchronous Design

Along with the creation of the endpoints, the application contains an asynchronous version of the 
Api. This is implemented using Akka actors and the integration with Akka and Scalatra.

The Actor model is defined in the class ListingActor along with the actor messages. The servlet that exposes the
asynchronous Api is ListingControllerAsync.

In there, I implemented all the 5 Api using the actor model

1. Search All Listing: http://localhost:8080/async/listings

2. Search Listing By Id: http://localhost:8080/async/listings/5e22a83a-6f4f-11e6-8b77-86f30ca893d3

3. Add a New Listing: http://localhost:8080/async/listings/add

4. Modify a Listing: http://localhost:8080/async/listings/f82f061f-ee3b-4d93-9601-844b701987c5

5. Delete a Listing: http://localhost:8080/async/listings/b0480bdf-ae64-483e-9af6-b0372ba29bc5